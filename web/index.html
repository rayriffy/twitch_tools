<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="./css/preflight.css" rel="stylesheet">
  <link href="./css/styles.css" rel="stylesheet">
</head>
<body>
  <div id="app"></div>
  <!-- <script src="./scripts/socket.ts"></script> -->
  <script>
    // const mockPayload = {
    //   type: 'image',
    //   src: 'https://storage.rayriffy.com/files/image/manaka.jpg',
    //   size: {
    //     width: 125,
    //     height: 125,
    //   },
    //   position: {
    //     x: 200,
    //     y: 300,
    //   },
    // }

    const mockPayload = {
      type: 'video',
      src: 'https://media.tenor.com/videos/5f98f77a8f00429f3a5d25b85e1c178d/mp4',
      size: {
        width: 200
      },
      position: {
        x: 200,
        y: 300,
      },
    }

    const wait = duration => new Promise(res => setTimeout(res, duration))

    const playPayload = async (payload, duration = 5000) => {
      if (mockPayload.type === 'image') {
        const imageElement = document.createElement('img')

        imageElement.src = mockPayload.src
        if (Number.isSafeInteger(mockPayload.size.width)) imageElement.width = mockPayload.size.width
        if (Number.isSafeInteger(mockPayload.size.height)) imageElement.height = mockPayload.size.height
        imageElement.style.position = 'absolute'
        imageElement.style.top = `${mockPayload.position.y}px`
        imageElement.style.left = `${mockPayload.position.x}px`
        imageElement.style.transition = 'all 0.6s ease-in-out'
        imageElement.style.opacity = 0

        document.querySelector('div#app').appendChild(imageElement)
        await wait(10)
        imageElement.style.opacity = 1

        // transition and remove element away when playback is complete
        setTimeout(async () => {
          imageElement.style.opacity = 0
          await wait(600)
          imageElement.remove()
        }, duration)
      } else if (mockPayload.type === 'video') {
        const videoElement = document.createElement('video')

        videoElement.src = mockPayload.src
        if (Number.isSafeInteger(mockPayload.size.width)) videoElement.width = mockPayload.size.width
        videoElement.style.height = Number.isSafeInteger(mockPayload.size.height) ? mockPayload.size.height : 'auto'
        videoElement.style.position = 'absolute'
        videoElement.style.top = `${mockPayload.position.y}px`
        videoElement.style.left = `${mockPayload.position.x}px`
        videoElement.style.transition = 'all 0.6s ease-in-out'
        videoElement.style.opacity = 0

        // video must be muted to be able to play
        videoElement.autoplay = true
        videoElement.muted = true
        videoElement.loop = true

        document.querySelector('div#app').appendChild(videoElement)
        await wait(10)
        videoElement.style.opacity = 1

        // transition and remove element away when playback is complete
        setTimeout(async () => {
          videoElement.style.opacity = 0
          await wait(600)
          videoElement.remove()
        }, duration)
      }
    }

    playPayload()
  </script>
</body>
</html>
